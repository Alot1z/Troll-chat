name: 🚀 Full Build (CommitTools + Build)

on:
  workflow_dispatch:

jobs:
  full:
    runs-on: macos-latest
    permissions:
      contents: write

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 🧾 Configure Git identity
        run: |
          git config --global user.name "TrollChat Auto Builder"
          git config --global user.email "trollchat-bot@users.noreply.github.com"

      - name: 🧹 Clean previous build (optional)
        run: make clean || true

      - name: 📦 Clone llama.cpp if missing
        run: |
          if [ ! -f "llama/build/bin/llama" ]; then
            git clone https://github.com/ggerganov/llama.cpp.git llama
          fi

      - name: 🏗️ Build project with Makefile
        run: make package

      - name: 📤 Upload IPA
        uses: actions/upload-artifact@v4
        with:
          name: TrollChat.ipa
          path: TrollChat.ipa
