name: üì¶ Manual Smart ZIP Unpack

on:
  workflow_dispatch:
    inputs:
      zipfile:
        description: "ZIP filename in root (e.g. trollchat_full_project.zip)"
        required: true
        default: "trollchat_full_project.zip"

jobs:
  unpack:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üßæ Set Git identity
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: üîç Show working directory and files
        run: |
          echo "üîé Current path: $(pwd)"
          echo "üìÇ Files:"
          ls -alh

      - name: üîê Store input ZIP filename as env var
        id: vars
        run: echo "ZIPFILE=${{ github.event.inputs.zipfile }}" >> $GITHUB_ENV

      - name: ‚ùì Check if ZIP file exists
        run: |
          if [ ! -f "$ZIPFILE" ]; then
            echo "‚ùå ZIP file not found: $ZIPFILE"
            exit 9
          else
            echo "‚úÖ Found ZIP: $ZIPFILE"
          fi

      - name: üì¶ Unpack ZIP to unpack_temp
        run: |
          mkdir -p unpack_temp
          unzip -o "$ZIPFILE" -d unpack_temp

      - name: üß† Copy unpacked files (skips .github/**)
        run: |
          cd unpack_temp
          find . -type f | while read -r file; do
            rel="${file#./}"
            if [[ "$rel" == .github/* ]]; then
              echo "‚è© Skipping .github file: $rel"
              continue
            fi
            echo "‚úÖ Overwriting: $rel"
            mkdir -p "../$(dirname "$rel")"
            cp -f "$file" "../$rel"
          done
          cd ..

      - name: ‚úÖ Done
        run: |
          echo "üü¢ All files successfully unpacked."
          echo "üìå ZIP file '$ZIPFILE' kept."
          echo "‚úã Please commit & push manually if desired."
