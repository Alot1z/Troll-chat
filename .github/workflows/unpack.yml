on:
  workflow_dispatch:
    inputs:
      zipfile:
        description: 'ZIP-filnavn (efterlad tom for automatisk valg)'
        required: false

jobs:
  unpack:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: 📥 Checkout repo
      uses: actions/checkout@v4

    - name: 🔍 Find ZIP-fil automatisk hvis input mangler
      id: zipfile
      run: |
        if [ -z "${{ github.event.inputs.zipfile }}" ]; then
          found_zip=$(find . -maxdepth 1 -name "*.zip" | head -n 1 | sed 's|^\./||')
          echo "Ingen input – bruger: $found_zip"
          echo "zipfile=$found_zip" >> $GITHUB_OUTPUT
        else
          echo "zipfile=${{ github.event.inputs.zipfile }}" >> $GITHUB_OUTPUT
        fi

    - name: 📂 Unzip ZIP-fil
      run: |
        mkdir temp_unzip
        unzip -q "${{ steps.zipfile.outputs.zipfile }}" -d temp_unzip
        cp -r temp_unzip/* ./
        rm "${{ steps.zipfile.outputs.zipfile }}"

    - name: ✅ Commit og push ændringer
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add .
        git commit -m "✅ Automatisk unpack af ZIP: ${{ steps.zipfile.outputs.zipfile }}" || echo "Intet nyt"
        git push origin HEAD
